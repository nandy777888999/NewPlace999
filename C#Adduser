using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using Microsoft.Office.Core;
using Microsoft.Office.Interop.Excel;
using System.IO;
using System.Reflection;
using System.Xml;

namespace WindowsFormsApplication1
{
    public partial class ZengJiaYHForm1 : Form
    {
        public static string[] UserName06 = new string[100];
        public static string[] PassWord06 = new string[100];
        public static string[] Admin06 = new string[100];
        public static string[] AdminPwd06 = new string[100];

        public static int YongHuArreyIndex06;
        public static int GuanLiyuanArreyIndex06;

        public static int NewUserNameIndex06;//新用户元素值
        public static int NewAdminNameIndex06;//新用户元素值
        public ZengJiaYHForm1()
        {
            InitializeComponent();
        }

        private void button1_Click(object sender, EventArgs e)//关闭
        {
            this.Close();
        }

        private void ZengJiaYHForm1_Load(object sender, EventArgs e)
        {

            ReadXMLConfigFile_INIT();
            this.ControlBox = false;


           
        }

        private void button2_Click(object sender, EventArgs e)//确定
        {
            AddNewYH();//zeng jia xin yong hu 
            CreatXMLConfigFile_INIT();//重新保存
            this.Close();

        }


        private void ReadXMLConfigFile_INIT()//创建系统XML配置文件
        {
            if (true)//判断
            {
                XmlDocument doc = new XmlDocument();
                doc.Load(GuanLiForm1.SysConfigPath01);    //加载Xml文件,全路径  
                XmlElement rootNodes = doc.DocumentElement;   //获取根节点  

                /*----------------------------读取IndexValue-----------------------*/
                XmlNodeList PointNodes = rootNodes.GetElementsByTagName("IndexValue"); //获取节点名字
                 foreach (XmlNode node in PointNodes)
                {
                    string ArreyIndex = ((XmlElement)node).GetAttribute("Value");   //获取UserName属性值
                    NewUserNameIndex06 = int.Parse(ArreyIndex);
                }         
                MessageBox.Show("NewUserNameIndex06读取完成！请继续操作！！" + NewUserNameIndex06);


                /*----------------------------读取NewUserName-----------------------*/
                for (int i=0;i< NewUserNameIndex06+1;i++)
                {
                    XmlNodeList PointNodes02 = rootNodes.GetElementsByTagName("USER" + i); //获取节点名字
                    foreach (XmlNode node in PointNodes02)
                    {
                         UserName06[i] = ((XmlElement)node).GetAttribute("UserName");   //获取UserName属性值
                         PassWord06[i] = ((XmlElement)node).GetAttribute("PassWord");   //获取UserName属性值
                  }

                }

                MessageBox.Show("UserName读取完成！请继续操作！！" + NewUserNameIndex06);


                /*----------------------------读取NewAdminNameIndex06-----------------------*/


                XmlNodeList PointNodes12 = rootNodes.GetElementsByTagName("AdminIndexValue"); //获取节点名字
            foreach (XmlNode node in PointNodes12)
            {
                string ArreyIndex12 = ((XmlElement)node).GetAttribute("AdminValue");   //获取UserName属性值

                    NewAdminNameIndex06 = int.Parse(ArreyIndex12);

            }

            MessageBox.Show("NewAdminNameIndex06读取完成！请继续操作！！" + NewUserNameIndex06);

                /*----------------------------读取NewAdminName-----------------------*/

                for (int i = 0; i < NewAdminNameIndex06 + 1; i++)
            {
                XmlNodeList PointNodes02 = rootNodes.GetElementsByTagName("ADMIN" + i); //获取节点名字
                foreach (XmlNode node in PointNodes02)
                {
                        Admin06[i] = ((XmlElement)node).GetAttribute("Admin");   //获取UserName属性值
                        AdminPwd06[i] = ((XmlElement)node).GetAttribute("AdminPwd");   //获取UserName属性值
                }

            }

              MessageBox.Show("UserName读取完成！请继续操作！！" + Admin06[0]);
        }    
    }

        private void AddNewYH()//创建系统XML配置文件
        {
            NewUserNameIndex06 = NewUserNameIndex06 + 1;//自增加一，产生新用户名数组数标。
            for (int i = 0; i < NewUserNameIndex06; i++)
            {
                if ((ZYHMtextBox1.Text != UserName06[i]) && (ZYHMMtextBox2.Text == ZYHMMtextBox3.Text))//来自于管理面板GuanLiForm1

                {
                    if(i == (NewUserNameIndex06-1))
                    {
                        UserName06[NewUserNameIndex06] = null;
                        PassWord06[NewUserNameIndex06] = null;
                        UserName06[NewUserNameIndex06] = ZYHMtextBox1.Text;//新用户名直接赋值
                        PassWord06[NewUserNameIndex06] = ZYHMMtextBox2.Text;//新密码直接赋值
                        MessageBox.Show("提示：用户名已经启用！！！");
                       
                    }
                   
                }
                else
                {
                    if (ZYHMtextBox1.Text == UserName06[i])
                    {
                        MessageBox.Show("提示：用户名已经存在，请输入新用户名！！！");
                        NewUserNameIndex06 = NewUserNameIndex06 -1;
                        break;
                    }
                    else
                    {
                        MessageBox.Show("提示：请重试！！！");
                        NewUserNameIndex06 = NewUserNameIndex06 -1;
                        break;
                    }
                }            
            }
        }


        private void CreatXMLConfigFile_INIT()//创建系统XML配置文件
        {
            XmlDocument xmldoc;
            XmlElement xmlelem;
            xmldoc = new XmlDocument();//声明xml格式的 xmldoc文件
            //加入XML的声明段落,<?xml version="1.0" encoding="gb2312"?>
            XmlDeclaration xmldecl;
            xmldecl = xmldoc.CreateXmlDeclaration("1.0", "gb2312", null);
            xmldoc.AppendChild(xmldecl);
            //加入一个根元素
            xmlelem = xmldoc.CreateElement("", "Employees", "");
            xmldoc.AppendChild(xmlelem);

            //加入另外一个元素
            /*-----------------------------写入UserName--------------------------*/
             XmlNode root01 = xmldoc.SelectSingleNode("Employees");//查找<Employees>


            for (int i=0;i< NewUserNameIndex06+1;i++)     //范围增一
             {
                 XmlElement xe12 = xmldoc.CreateElement("USER" + i);//创建一个<Node>节点
                 xe12.SetAttribute("UserName", UserName06[i]);//设置该节点genre属性
                 xe12.SetAttribute("PassWord", PassWord06[i]);//设置该节点ISBN属性
                 root01.AppendChild(xe12);//添加到<Employees>节点中
             }

            /*-----------------------------写入IndexValue--------------------------*/

            XmlNode root = xmldoc.SelectSingleNode("Employees");//查找<Employees>
             XmlElement xe1 = xmldoc.CreateElement("IndexValue");//创建一个<Node>节点

             xe1.SetAttribute("Value", NewUserNameIndex06.ToString());//设置该节点Value通过ArreyIndexValue01.ToString()赋值0属性
             root.AppendChild(xe1);//添加到<Employees>节点中

            
            /*-----------------------------写入AdminName--------------------------*/
            XmlNode root02 = xmldoc.SelectSingleNode("Employees");//查找<Employees>


            for (int i = 0; i < NewAdminNameIndex06 + 1; i++)     //范围增一
            {
                XmlElement xe31 = xmldoc.CreateElement("Admin" + i);//创建一个<Node>节点
                xe31.SetAttribute("Admin", Admin06[i]);//设置该节点genre属性
                xe31.SetAttribute("AdminPwd", AdminPwd06[i]);//设置该节点ISBN属性
                root01.AppendChild(xe31);//添加到<Employees>节点中
            }

            /*-----------------------------写入IndexValue--------------------------*/

            XmlNode root03 = xmldoc.SelectSingleNode("Employees");//查找<Employees>
            XmlElement xe33 = xmldoc.CreateElement("AdminIndexValue");//创建一个<Node>节点
            xe33.SetAttribute("AdminValue", NewAdminNameIndex06.ToString());//设置该节点Value通过ArreyIndexValue01.ToString()赋值0属性
            root.AppendChild(xe33);//添加到<Employees>节点中

            /*-----------------------------保存--------------------------*/
            xmldoc.Save(GuanLiForm1.SysConfigPath01);
            
        }



    }
 }



